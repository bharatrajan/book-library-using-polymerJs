<dom-module id="book-listing">

  <template>
    <style>
        :host {}
        .list-books{
          background-color: #EBEEF0;
        }
        .list-books-title {
          padding: 10px 0;
          background: #000;
          text-align: center;
          font-family: RalewayEL;
        }
        .list-books-title h1 {
          font-weight: 400;
          margin: 0;
          color: white;
        }
        .list-books-content {
          background-color: #EBEEF0;
          padding: 0 0 80px;
          flex: 1;
        }
        .open-search {
          position: fixed;
          right: 25px;
          bottom: 25px;
        }
        .open-search a {
          display: block;
          width: 50px;
          height: 50px;
          border-radius: 50%;
          background: #0272B6;
          background-image: url('/icons/add.svg');
          background-repeat: no-repeat;
          background-position: center;
          background-size: 28px;
          box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
          font-size: 0;
        }
        .no-book-found{
          padding-top: 10%;
          text-align: center;
        }
    </style>
    <div class="list-books">
      <div class="list-books-title">
        <h1>LIBRARY</h1>
      </div>

      <div class="no-book-found" hidden="{{!model.noBookFound}}">
        You don't have any book.
        <br/>
        Please add at least 1 book
        <br/>
        Reading is good
      </div>

      <div class="list-books-content">

        <book-shelf book-list="[[model.continueReadingList]]" data-title="Continue Reading">
        </book-shelf>
        <book-shelf book-list="[[model.wantToReadList]]" data-title="Want to read">
        </book-shelf>
        <book-shelf book-list="[[model.readList]]" data-title="read">
        </book-shelf>

      </div>
      <div class="open-search">
        <a href="/#search">Add a book</a>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'book-listing',

      properties: {

        dataTitle : {
          type: String,
          reflectToAttribute: true
        },

        model : {
          type: Object,
          value : {
            "noBookFound": false,
            "continueReadingList": [],
            "wantToReadList": [],
            "readList": []
          }
        }

      },

      listeners:{
        "refreshList": "onUpdateSuccess",
        "onAPIError": "onAPIError",
        "onGetSuccess": "onGetSuccess",
        "onUpdateSuccess": "onUpdateSuccess",
        "onBookShelfChanged": "onBookShelfChanged"
      },

      onAPIError: function(event, detail) {
        console.log("detail", detail);
      },

      onGetSuccess: function(event, detail) {
        var i, continueReadingList = [],
               wantToReadList = [],
               readList = [], switchLogic = {};

       switchLogic = {
                        "currentlyReading": function(book){continueReadingList.push(book)},
                        "wantToRead": function(book){wantToReadList.push(book)},
                        "read": function(book){readList.push(book)}
                      };


        detail.books.forEach(function(book){
          switchLogic[book.shelf](book)
        });

        this.set("model.continueReadingList", continueReadingList);
        this.set("model.wantToReadList", wantToReadList);
        this.set("model.readList", readList);
        this.set("model.noBookFound", detail.books.length === 0);

      },

      onBookShelfChanged: function(event, detail) {
        this.BooksApi.updateBook(detail.bookId, detail.newShelf);
      },

      onUpdateSuccess: function(event, detail) {
        this.BooksApi.getAllBooks();
      },

      attached: function() {
        this.BooksApi = new BooksApi({});
        this.appendChild(this.BooksApi);
        this.BooksApi.getAllBooks();
      }

    });
  </script>

</dom-module>
